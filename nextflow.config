/*
 * nextflow.config for plasmid-methylation-qc
 *
 * Defines:
 *  - default params
 *  - resource hints per process
 *  - execution profiles (local by default)
 */

params {
  //
  // Core pipeline inputs
  //
  samplesheet = 'samplesheet.csv'
  outdir      = 'results'

  //
  // Pileup settings
  //
  mod_prob    = 0.5        // probability threshold for calling a site modified
  mod_code    = 'a'        // mod_code to treat as the primary modification

  //
  // Combine step
  //
  combine_run = true       // run the per-treatment combine step by default
}

timeline {
  enabled   = true
  file      = 'timeline.html'
  overwrite = true
}

trace {
  enabled   = true
  file      = 'trace.txt'
  overwrite = true
}

report {
  enabled   = true
  file      = 'report.html'
  overwrite = true
}

dag {
  enabled = true
  file    = 'flowchart.png'
  overwrite = true
}

process {
  errorStrategy = 'retry'
  maxRetries    = 1
  cpus          = 2
  memory        = '2 GB'
  time          = '2h'

  withName: EXTRACT_FULL {
    cpus   = 2
    memory = '2 GB'
  }

  withName: TSV_TO_PARQUET {
    cpus   = 1
    memory = '1 GB'
  }

  withName: EXTRACT_COLLAPSED {
    cpus   = 1
    memory = '1 GB'
  }

  withName: PILEUP_R {
    cpus   = 2
    memory = '2 GB'
  }

  withName: COMBINE_RUN {
    cpus   = 2
    memory = '2 GB'
  }
}

profiles {

  // Default profile (used when you don't pass -profile)
  standard {
    process.executor = 'local'
    workDir          = 'work'
  }

  // Explicit local profile
  local {
    process.executor = 'local'
    workDir          = 'work'
  }

  // Skeleton for an HPC/SLURM profile (example only)
  // slurm {
  //   process.executor = 'slurm'
  //   workDir          = '/path/to/scratch/work'
  //
  //   process {
  //     queue  = 'short'
  //     cpus   = 8
  //     memory = '8 GB'
  //   }
  // }
}

